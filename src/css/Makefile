################################################################################
## CONFIG ######################################################################
################################################################################
SRC_DIR ?= ${CURDIR}/src
WWW_DIR ?= ${CURDIR}/www

SCSS_EXEC = scss
################################################################################
## MAKEFILE MAGIC ##############################################################
################################################################################
#INCLUDE_SCSS = $(shell find $(SRC_DIR)/shared/ -name ".scss")
INCLUDE_SCSS = $(shell find $(SRC_DIR) -name ".scss")
SCSS_FILES = $(shell find $(SRC_DIR) -name "main.scss")
CSS_FILES = $(patsubst $(SRC_DIR)/%.scss,$(WWW_DIR)/%.css,$(SCSS_FILES))
CSS_DIRECTORIES = $(dir $(CSS_FILES))

################################################################################
## SANITY CHECKS ###############################################################
################################################################################

################################################################################
## TARGET RULES ################################################################
################################################################################
build: $(WWW_DIR) $(CSS_DIRECTORIES) $(CSS_FILES)

clean:
	rm -f $(CSS_FILES)

reset:
	$(MAKE) -C clean

$(WWW_DIR):
	mkdir -p $@

################################################################################
## INTERNAL RULES ##############################################################
################################################################################
$(CSS_DIRECTORIES):
	mkdir -p $@

$(CSS_FILES): $(WWW_DIR)/%.css: $(SRC_DIR)/%.scss $(INCLUDE_SCSS)
	$(SCSS_EXEC) $< > $@
